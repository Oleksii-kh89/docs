"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[5355],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>g});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),m=p(a),d=r,g=m["".concat(s,".").concat(d)]||m[d]||u[d]||l;return a?n.createElement(g,i(i({ref:t},c),{},{components:a})):n.createElement(g,i({ref:t},c))}));function g(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,i=new Array(l);i[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[m]="string"==typeof e?e:r,i[1]=o;for(var p=2;p<l;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},27172:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var n=a(87462),r=(a(67294),a(3905));const l={sidebar_position:1,sidebar_label:"Optimal Performance Hardware setup"},i="Optimal Performance Hardware setup",o={unversionedId:"installation-steps/OptimalPerformanceHardwareSetup",id:"installation-steps/OptimalPerformanceHardwareSetup",title:"Optimal Performance Hardware setup",description:"Find below the recommended hardware configuration to set up ReportPortal and have good performance using our centralized test automation tool.",source:"@site/docs/installation-steps/OptimalPerformanceHardwareSetup.mdx",sourceDirName:"installation-steps",slug:"/installation-steps/OptimalPerformanceHardwareSetup",permalink:"/docs/installation-steps/OptimalPerformanceHardwareSetup",draft:!1,editUrl:"https://github.com/reportportal/docs/blob/develop/docs/installation-steps/OptimalPerformanceHardwareSetup.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,sidebar_label:"Optimal Performance Hardware setup"},sidebar:"defaultSidebar",previous:{title:"Installation Steps",permalink:"/docs/category/installation-steps"},next:{title:"Basic monitoring configuration",permalink:"/docs/installation-steps/BasicMonitoringConfiguration"}},s={},p=[{value:"1.  Disk I/O",id:"1--disk-io",level:2},{value:"2. CPU utilization",id:"2-cpu-utilization",level:2},{value:"3. Which scale I need? Configuration testing results and saturation points<br/>",id:"3-which-scale-i-need-configuration-testing-results-and-saturation-points",level:2},{value:"4. The database separately from other services<br/>",id:"4-the-database-separately-from-other-services",level:2},{value:"5. PostgreSQL Performance Tuning",id:"5-postgresql-performance-tuning",level:2},{value:"6. Application connections pool tuning",id:"6-application-connections-pool-tuning",level:2},{value:"7. Elasticsearch Performance Tuning",id:"7-elasticsearch-performance-tuning",level:2}],c={toc:p},m="wrapper";function u(e){let{components:t,...l}=e;return(0,r.kt)(m,(0,n.Z)({},c,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"optimal-performance-hardware-setup"},"Optimal Performance Hardware setup"),(0,r.kt)("p",null,"Find below the recommended hardware configuration to set up ReportPortal and have good performance using our centralized test automation tool."),(0,r.kt)("h2",{id:"1--disk-io"},"1.  Disk I/O"),(0,r.kt)("p",null,"   To speed up PostgreSQL database performance, on instance strongly recommended use ",(0,r.kt)("strong",{parentName:"p"},"SSD disk")," hardware."),(0,r.kt)("h2",{id:"2-cpu-utilization"},"2. CPU utilization"),(0,r.kt)("p",null,"   Consider choosing the ",(0,r.kt)("strong",{parentName:"p"},"CPU optimized")," instances to reduce high CPU utilization of the ReportPortal service-API and speed up ReportPortal overall."),(0,r.kt)("p",null,"   For example:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Azure"),": Fsv2-series instances,")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"AWS"),": c5 instances."),(0,r.kt)("p",{parentName:"li"},"The instance capacity(4 CPUs/8Gb RAM or 8 CPUs/16Gb RAM etc.) should be selected regarding average reporting test-cases/day and average CPU/RAM utilization. If the CPU/RAM utilization of the ReportPortal instance up to 100% a long time daily, consider scale up the VM x2."))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"System hardware requirements")),(0,r.kt)("p",null,"   Simple Docker installation from the box:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Server type"),(0,r.kt)("th",{parentName:"tr",align:null},"CPU's"),(0,r.kt)("th",{parentName:"tr",align:null},"RAM size, Gb"),(0,r.kt)("th",{parentName:"tr",align:null},"Disk space, Gb"),(0,r.kt)("th",{parentName:"tr",align:null},"Disk type"),(0,r.kt)("th",{parentName:"tr",align:null},"AWS Shape"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Small"),(0,r.kt)("td",{parentName:"tr",align:null},"4"),(0,r.kt)("td",{parentName:"tr",align:null},"8"),(0,r.kt)("td",{parentName:"tr",align:null},"300"),(0,r.kt)("td",{parentName:"tr",align:null},"gp2"),(0,r.kt)("td",{parentName:"tr",align:null},"c5.xlarge")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Middle"),(0,r.kt)("td",{parentName:"tr",align:null},"8"),(0,r.kt)("td",{parentName:"tr",align:null},"16"),(0,r.kt)("td",{parentName:"tr",align:null},"500"),(0,r.kt)("td",{parentName:"tr",align:null},"gp2"),(0,r.kt)("td",{parentName:"tr",align:null},"c5.2xlarge")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Middle+"),(0,r.kt)("td",{parentName:"tr",align:null},"16"),(0,r.kt)("td",{parentName:"tr",align:null},"32"),(0,r.kt)("td",{parentName:"tr",align:null},"1000"),(0,r.kt)("td",{parentName:"tr",align:null},"gp2"),(0,r.kt)("td",{parentName:"tr",align:null},"c5.4xlarge")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Large"),(0,r.kt)("td",{parentName:"tr",align:null},"32"),(0,r.kt)("td",{parentName:"tr",align:null},"64"),(0,r.kt)("td",{parentName:"tr",align:null},"2000"),(0,r.kt)("td",{parentName:"tr",align:null},"gp2"),(0,r.kt)("td",{parentName:"tr",align:null},"c5a.8xlarge")))),(0,r.kt)("br",null),(0,r.kt)("p",null,"   Kubernetes:"),(0,r.kt)("media-view",{src:a(58882),alt:"Kubernetes server types for our centralized test automation tool"}),(0,r.kt)("hr",null),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"In Report Portal version 5.7.3, the log double-entry saving approach to DB and Elasticsearch (to data streams) has been implemented. This saving approach reduces the DB footprint almost x10 times, improves the speed of reporting logs, minimizes computation power to clean up data, and brings full-text search capabilities.\xa0Our general recommendation is to roll out Elasticsearch on the separate cluster nodes if you have a Kubernetes deployment (consider creating the node group for Elasticsearch). But if you have or expect a large amount of the logs reporting, separate cluster nodes for Elasticsearch are required. The proposed shapes for Elasticsearch nodes have been verified during performance testing and perform stable without degradation on all server configurations (from Small server type to Large). However, if you report many logs, you can tune the node's Disk size or scale up the shapes according to your needs. In addition, please pay attention to the number of Elasticsearch active shards (primary and total). In case you have a large count of projects, additional tuning for Elasticsearch might be needed(due to limitations that Elasticsearch has on the number of active shards). Please see Part 7 below for the tips.")),(0,r.kt)("p",null,"Additional nodes for Elasticsearch:"),(0,r.kt)("media-view",{src:a(48073),alt:"Additional nodes for Elasticsearch in ReportPortal Testops"}),(0,r.kt)("hr",null),(0,r.kt)("br",null),"**io2 = 1 GB per month x 0.149 USD x 1 instances = 0.149 USD (EBS Storage Cost) / iops = 1 Provisioned IOPS x 0.119 USD x 1 instances = 0.119 USD (EBS IOPS Cost)*",(0,r.kt)("br",null),"***Replica*",(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The approximate server's cost is relevant for the current cost of infrastructure on AWS. The estimated server cost is the current cost of the AWS infrastructure. When changing any cost of resources, costs need to be recalculated.")),(0,r.kt)("br",null),(0,r.kt)("h2",{id:"3-which-scale-i-need-configuration-testing-results-and-saturation-points"},"3. Which scale I need? Configuration testing results and saturation points",(0,r.kt)("br",null)),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"What does Saturation and vUser means? How to transform it into test cases?")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"RPS")," means ",(0,r.kt)("em",{parentName:"p"},"Requests Per Second"),". Any request to server to upload, create, read the data. In ReportPortal terms it can be request to create Launch (execution), Test Suite, Test case, log line. Read data or update data."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Saturation")," (in RPS) can be assumed as maximum capacity of your configuration (app deployed on specifics instance type) which can procced requests without significant response time degradation. Let's say ",(0,r.kt)("inlineCode",{parentName:"p"},"upper limit")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"vUser")," means ",(0,r.kt)("em",{parentName:"p"},"Virtual user")," which describes regular model of behaviour of user (API client) which interacts with your system. Under vUser we assume test framework integration which will generate:"),(0,r.kt)("p",null,"\u25fe\ufe0f 3 Launches with"),(0,r.kt)("p",null,"\u25fe\ufe0f\u25fe\ufe0f 3 suites inside, with"),(0,r.kt)("p",null,"\u25fe\ufe0f\u25fe\ufe0f\u25fe\ufe0f 3 test classes inside, with"),(0,r.kt)("p",null,"\u25fe\ufe0f\u25fe\ufe0f\u25fe\ufe0f\u25fe\ufe0f 3 test cases inside, with"),(0,r.kt)("p",null,"\u25fe\ufe0f\u25fe\ufe0f\u25fe\ufe0f\u25fe\ufe0f\u25fe\ufe0f 5 steps inside, with"),(0,r.kt)("p",null,"\u25fe\ufe0f\u25fe\ufe0f\u25fe\ufe0f\u25fe\ufe0f\u25fe\ufe0f\u25fe\ufe0f 10 logs inside for each step."),(0,r.kt)("p",null,"Which practically will generate:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"10 * 5 * 3 * 3 * 3 * 3 = (4050)")," ",(0,r.kt)("inlineCode",{parentName:"li"},"createLog")," requests."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"5 * 3 * 3 * 3 * 3 = (405)")," ",(0,r.kt)("inlineCode",{parentName:"li"},"startStep")," requests and equal amount of ",(0,r.kt)("inlineCode",{parentName:"li"},"finishStep")," requests. Total 810"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"3 * 3 * 3 * 3 = (81)")," ",(0,r.kt)("inlineCode",{parentName:"li"},"startTest")," requests and equal amount of ",(0,r.kt)("inlineCode",{parentName:"li"},"finishTest")," requests (inclluding all precondition methods, as ",(0,r.kt)("inlineCode",{parentName:"li"},"@After")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"@Before")," in Java). Total 162"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"3 * 3 * 3 = (27)")," ",(0,r.kt)("inlineCode",{parentName:"li"},"startTestClass")," requests and equal amount of ",(0,r.kt)("inlineCode",{parentName:"li"},"finishTestClass")," requests. Total 54"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"3 * 3 = (9)")," ",(0,r.kt)("inlineCode",{parentName:"li"},"startSuite")," requests and equal amount of ",(0,r.kt)("inlineCode",{parentName:"li"},"finishSuite")," requests. Total 18"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"3 = (3)")," ",(0,r.kt)("inlineCode",{parentName:"li"},"startLaunch")," requests and equal amount of ",(0,r.kt)("inlineCode",{parentName:"li"},"finishLaunch")," requests. Total 6")),(0,r.kt)("p",null,"Default configuration of integration sends logs in batches (",(0,r.kt)("inlineCode",{parentName:"p"},"rp.batch.size.logs = 20"),") which combines 20 requests at once into 1 batch request for ",(0,r.kt)("inlineCode",{parentName:"p"},"createLog"),". And minimize count of ",(0,r.kt)("inlineCode",{parentName:"p"},"createLog")," requests from 4050 to 203.\nIn grand total such a structure creates 3 Launches with 243 test case inside and produces 1253 requests."),(0,r.kt)("p",null,"Now we can divide their number by the duration in seconds, and get the RPS result. if it runs for 6 minutes (2 minutes each lunch), then: 60s * 6 = 360 and 1253 / 360 ~=4.5 requests per second."),(0,r.kt)("p",null,"If launches will be executed in parallel, 3 at the time, then RPS will be equal to 4.5*3 = 13.5 rps."),(0,r.kt)("br",null),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Summary")),(0,r.kt)("p",null,"Having information regarding number of test cases in your framework, average number of logs, number of parallel threads and durations, you can calculate system capacity according to the tables below."),(0,r.kt)("br",null),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Configuration testing results")),(0,r.kt)("p",null,"The purpose of the configuration performance testing is to determine saturation points and overall system capacity for different instance sizes and specifications. Testing was conducted on the \u04215 instances which are optimized for compute-intensive workloads and deliver cost-effective high performance at a low price per compute ratio(Compute Optimized Instances) with Up to 3.4GHz, and single core turbo frequency of up to 3.5 GHz 2nd generation Intel Xeon Scalable Processors (Cascade Lake) or 1st generation Intel Xeon Platinum 8000 series (Skylake-SP) processor with a sustained all core Turbo frequency."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Application and Database are deployed on separate VMs")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Instance Type")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Saturation point, rps")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"vUsers count")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Disk IOPS")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Java Options")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"\u04415.xlarge"),(0,r.kt)("td",{parentName:"tr",align:null},"640"),(0,r.kt)("td",{parentName:"tr",align:null},"60"),(0,r.kt)("td",{parentName:"tr",align:null},"up to 3000"),(0,r.kt)("td",{parentName:"tr",align:null},"-","Xmx1g")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"c5.2xlarge"),(0,r.kt)("td",{parentName:"tr",align:null},"1374"),(0,r.kt)("td",{parentName:"tr",align:null},"115"),(0,r.kt)("td",{parentName:"tr",align:null},"up to 4000"),(0,r.kt)("td",{parentName:"tr",align:null},"-","Xmx2g")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"c5.4xlarge"),(0,r.kt)("td",{parentName:"tr",align:null},"3104"),(0,r.kt)("td",{parentName:"tr",align:null},"356"),(0,r.kt)("td",{parentName:"tr",align:null},"up to 8000"),(0,r.kt)("td",{parentName:"tr",align:null},"-","Xmx3g")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"\u04415.9xlarge"),(0,r.kt)("td",{parentName:"tr",align:null},"5700"),(0,r.kt)("td",{parentName:"tr",align:null},"489"),(0,r.kt)("td",{parentName:"tr",align:null},"up to 10000"),(0,r.kt)("td",{parentName:"tr",align:null},"-","Xmx4g")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Application and Database are deployed on single VM")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Instance Type")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Saturation point, rps")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"vUsers count")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Disk IOPS")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Java Options")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"\u04415.xlarge"),(0,r.kt)("td",{parentName:"tr",align:null},"521"),(0,r.kt)("td",{parentName:"tr",align:null},"50"),(0,r.kt)("td",{parentName:"tr",align:null},"up to 3000"),(0,r.kt)("td",{parentName:"tr",align:null},"-","Xmx1g")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"c5.2xlarge"),(0,r.kt)("td",{parentName:"tr",align:null},"1078"),(0,r.kt)("td",{parentName:"tr",align:null},"83"),(0,r.kt)("td",{parentName:"tr",align:null},"up to 4000"),(0,r.kt)("td",{parentName:"tr",align:null},"-","Xmx2g")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"c5.4xlarge"),(0,r.kt)("td",{parentName:"tr",align:null},"2940"),(0,r.kt)("td",{parentName:"tr",align:null},"305"),(0,r.kt)("td",{parentName:"tr",align:null},"up to 8000"),(0,r.kt)("td",{parentName:"tr",align:null},"-","Xmx3g")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"\u04415.9xlarge"),(0,r.kt)("td",{parentName:"tr",align:null},"5227"),(0,r.kt)("td",{parentName:"tr",align:null},"440"),(0,r.kt)("td",{parentName:"tr",align:null},"up to 10000"),(0,r.kt)("td",{parentName:"tr",align:null},"-","Xmx4g")))),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("h2",{id:"4-the-database-separately-from-other-services"},"4. The database separately from other services",(0,r.kt)("br",null)),(0,r.kt)("p",null,"   Consider deploying the database separately from other RP services. It allows increasing throughput of the server and performance of the ReportPortal overall. This can be, for example, AWS RDS PostgreSQL Database or a separate VM only for the PostgreSQL database."),(0,r.kt)("p",null,"   The separate database instance should be the same by CPU's and RAM, but started from middle+ server type, the database instance may need to have doubled CPU's and RAM size in comparison with the application instance.\nThis is explained by the fact that with an increase in the size of the database and the number of concurrent users, the load is distributed more on the database server: increased volume of resources(CPU, memory, IOPS number, etc.) required to performing each DB query since it handles / can handle more data volume and/or can handle of a greater number of concurrent users."),(0,r.kt)("p",null,"Example for the middle+ server:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Instance type"),(0,r.kt)("th",{parentName:"tr",align:null},"CPU's"),(0,r.kt)("th",{parentName:"tr",align:null},"RAM size, Gb"),(0,r.kt)("th",{parentName:"tr",align:null},"Disk space, Gb"),(0,r.kt)("th",{parentName:"tr",align:null},"AWS Shape"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Application instance"),(0,r.kt)("td",{parentName:"tr",align:null},"16"),(0,r.kt)("td",{parentName:"tr",align:null},"32"),(0,r.kt)("td",{parentName:"tr",align:null},"200"),(0,r.kt)("td",{parentName:"tr",align:null},"c5.4xlarge")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Database instance"),(0,r.kt)("td",{parentName:"tr",align:null},"16"),(0,r.kt)("td",{parentName:"tr",align:null},"32"),(0,r.kt)("td",{parentName:"tr",align:null},"1000"),(0,r.kt)("td",{parentName:"tr",align:null},"c5.4xlarge")))),(0,r.kt)("br",null),(0,r.kt)("h2",{id:"5-postgresql-performance-tuning"},"5. PostgreSQL Performance Tuning"),(0,r.kt)("p",null,"   Since PostgreSQL Database is used, it needs some set of special configs for the best performance. These set contains two categories:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"general and universal for any capacity of the instance hardware:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"effective_io_concurrency=200\nrandom_page_cost=0.1\nseq_page_cost=1\nmin_wal_size=1GB\nmax_wal_size=4GB\nwal_buffers=16MB\ndefault_statistics_target=100\nsynchronous_commit=off\nwal_writer_delay=10ms\ncheckpoint_completion_target=0.9\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"based on CPU/RAM size at the instance(example for 4 CPUs/8GB RAM; the database is deployed on the separate VM):"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"shared_buffers=2GB\neffective_cache_size=6GB\nmaintenance_work_mem=512MB\nwork_mem=96MB\nmax_worker_processes=4\nmax_parallel_workers_per_gather=2\nmax_parallel_workers=4\nmax_parallel_maintenance_workers=2\n")),(0,r.kt)("p",{parentName:"li"},"Recommendations regarding ",(0,r.kt)("strong",{parentName:"p"},"PostgreSQL server tuning")," for the instance with 8 CPUs/16GB RAM(where all RP services are deployed):"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"shared_buffers=4GB\neffective_cache_size=8GB\nwal_buffers=16MB\ndefault_statistics_target=100\neffective_io_concurrency=200\nwork_mem=96MB\nmin_wal_size=1GB\nsynchronous_commit=off\nwal_writer_delay=10ms\nmaintenance_work_mem=1GB\nseq_page_cost=1\ncheckpoint_completion_target=0.9\nrandom_page_cost=0.1\nmax_wal_size=4GB\nmax_worker_processes=8\nmax_parallel_workers_per_gather=4\nmax_parallel_workers=8\nmax_parallel_maintenance_workers=4\n")),(0,r.kt)("p",{parentName:"li"},'If the PostgreSQL database and services are deployed on the separate VM\u2019s, the "effective_cache_size" parameter should be changed to "12GB"(total RAM size - shared_buffers size).'),(0,r.kt)("br",null),"**Simple ways to set these parameters:**",(0,r.kt)("p",{parentName:"li"},"CPU\u2019s count related:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"max_worker_processes = <DB instance CPU\u2019s count>\nmax_parallel_workers_per_gather = <DB instance CPU\u2019s count / 2>\nmax_parallel_workers = <DB instance CPU\u2019s count>\nmax_parallel_maintenance_workers = <DB instance CPU\u2019s count / 2>\n")),(0,r.kt)("p",{parentName:"li"},"RAM size related:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"shared_buffers = <DB instance RAM size in GB / 4>\neffective_cache_size = <DB instance RAM size in GB - shared_buffers>\nmaintenance_work_mem = < if total RAM size > 16 Gb \u2013 2Gb; under 16Gb \u2013 1Gb and less>\n")),(0,r.kt)("p",{parentName:"li"},"For the ",(0,r.kt)("strong",{parentName:"p"},"docker-compose:")," add the following lines to the ",(0,r.kt)("em",{parentName:"p"},"command")," section by the \u201c-c\u201d option to ",(0,r.kt)("em",{parentName:"p"},"\u201cpostgres\u201d")," service."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Example:")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"postgres:\n  image: postgres:12-alpine\n  shm_size: '512m'\n  ...\n  command:\n    -c effective_io_concurrency=200\n    -c random_page_cost=0.1\n    -c seq_page_cost=1\n    ...\n    # Some another configs\n")),(0,r.kt)("p",{parentName:"li"},"For the ",(0,r.kt)("strong",{parentName:"p"},"AWS RDS:")," create new parameter group(",(0,r.kt)("em",{parentName:"p"},"Services -> RDS -> Parameter groups -> Create parameter group"),"), search config by the name and set up the following values, then apply created parameter group to the RDS DB."),(0,r.kt)("p",{parentName:"li"},"The following parameters can be scaled and depends on CPU\u2019s number and RAM size of the instance. For example, for the instance 16 CPUs/32GB RAM(the database is deployed on the separate VM) this parameters should be:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"shared_buffers = '8GB'\neffective_cache_size = '24GB'\nmax_worker_processes = '16'\nmax_parallel_workers = '16'\n")))),(0,r.kt)("h2",{id:"6-application-connections-pool-tuning"},"6. Application connections pool tuning"),(0,r.kt)("p",null,"By default, ReportPortal has 27 connections on service-api and 27 connections in pool on service-authorization.\nIn general these values are valid for the small and middle servers. But from the middle+ server type, the connection pool may be increased if it's not enough for your server load."),(0,r.kt)("p",null,'It can be detected as periodic freezes and the "Loading" message when opening any page, and/or slowing down the work with RP after a certain period of time during active reporting and use with UI. Restarts of API and UAT services can also be observed.'),(0,r.kt)("p",null,"To increasing the connection pool on both services, need to add next environment variables to the service-api and to the service-authorization:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"RP_DATASOURCE_MAXIMUMPOOLSIZE=100\n")),(0,r.kt)("p",null,"After increasing the connection pool from the application side, do not forget increase the max_connections from the Database side, using following DB configuration paramether:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"max_connections=500\n")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"The values of these parameters are given for example only, but in general, can be valid for all types of loads for servers middle+ and large.")),(0,r.kt)("p",null,"Please note, that the max_connections paramether must be more than the sum of the RP_DATASOURCE_MAXIMUMPOOLSIZE for the API and the UAT services + several connections for connecting to the database from outside."),(0,r.kt)("h2",{id:"7-elasticsearch-performance-tuning"},"7. Elasticsearch Performance Tuning"),(0,r.kt)("p",null,"As mentioned above, in some cases may be necessary to increase the limits of shards. The general rule is 2 active shards per 1 data stream(1 data stream equals 1 project in the ReportPortal on the default configuration). If the data stream reaches the default 50 GB storage limit, it will be rollovered and a new generation will be created (please see the diagram below). Please consider that the number of Elasticsearch shards on the default configuration is insufficient for ReportPortal installations with a large number of projects. As a result, after storing close to 3000 indices without any tuning the logs-saving behavior may be incorrect."),(0,r.kt)("media-view",{src:a(3543),alt:"Elasticsearch Performance Tuning in our test automation dashboard"}),(0,r.kt)("p",null,"To retrieve statistics from a cluster (",(0,r.kt)("em",{parentName:"p"},"to check the value of shard"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'GET /_cluster/stats\n\n{\n    "_nodes": {\n        "total": 3,\n        "successful": 3,\n        "failed": 0\n    },\n    "cluster_name": "elasticsearch",\n    "cluster_uuid": "Oq5UUZUg3RGE0Pa_Trfds",\n    "timestamp": 172365897412,\n    "status": "green",\n    "indices": {\n        "count": 470,\n        "shards": {\n            "total": 940,\n            "primaries": 470,\n            "replication": 1.0,\n            "index": {\n                "shards": {\n                    "min": 2,\n                    "max": 2,\n                    "avg": 2.0\n                },\n...\n}\n')),(0,r.kt)("p",null,"The API returns basic index metrics (shard numbers, store size, memory usage) and information about the current nodes that form the cluster (number, roles, os, jvm versions, memory usage, cpu and installed plugins)."),(0,r.kt)("p",null,"To increase the limits of the total number of primary and replica shards for the cluster:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'PUT /_cluster/settings\n\n{\n  "persistent" : {\n    "cluster.max_shards_per_node": 3000\n  }\n}\n')),(0,r.kt)("p",null,"Keep in mind, that the more shards you allow per node the more resources each node will need and the worse the performance can get."),(0,r.kt)("p",null,"We also recommend to check the next guides in the official Elasticsearch documentation:"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/master/data-streams.html"},"Data streams")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/size-your-shards.html"},"Size your shards")))}u.isMDXComponent=!0},58882:(e,t,a)=>{a.r(t),a.d(t,{default:()=>n});const n=a.p+"assets/images/OptimalPerformanceHardwareSetup1-853b07d3144e0ea58124dd0f67392a2f.png"},3543:(e,t,a)=>{a.r(t),a.d(t,{default:()=>n});const n=a.p+"assets/images/OptimalPerformanceHardwareSetup2-61518d7a23650dd99e0f0179ad5ce4c3.png"},48073:(e,t,a)=>{a.r(t),a.d(t,{default:()=>n});const n=a.p+"assets/images/OptimalPerformanceHardwareSetup3-d61abb32675ccfe8fa6e9797fa80037e.png"}}]);